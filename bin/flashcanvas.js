/*
 * FlashCanvas
 *
 * Copyright (c) 2009 Tim Cameron Ryan
 * Released under the MIT/X License
 *
 * @author Tim Cameron Ryan
 * @author Shinya Muramatsu
 */
(function(){function r(a){for(var b=0,c=a.length;b<c;b++)this[a[b]]=b}function l(a){var b=a.canvas.uniqueID;arguments.callee[b]||(arguments.callee[b]=0);return arguments.callee[b]++}function s(a){var b=a.propertyName;if(b=="width"||b=="height"){a=a.srcElement;var c=a.getContext("2d"),e=parseInt(a[b]);if(isNaN(e)||e<0)e=b=="width"?300:150;a.style[b]=e+"px";c.z(a.clientWidth,a.clientHeight)}}function t(){window.detachEvent("onbeforeunload",arguments.callee);for(var a=document.getElementsByTagName("canvas"),
b=0,c=a.length;b<c;++b){var e=a[b],g=e.firstChild,f;for(f in g)if(typeof g[f]=="function")g[f]=null;for(f in e)if(typeof e[f]=="function")e[f]=null}}var m=function(){var a=document.getElementsByTagName("script");return a[a.length-1].getAttribute("src",2)}().replace(/[^\/]+$/,"")+"flashcanvas.swf",d=new r(["toDataURL","save","restore","scale","rotate","translate","transform","setTransform","globalAlpha","globalCompositeOperation","strokeStyle","fillStyle","createLinearGradient","createRadialGradient",
"createPattern","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","clearRect","fillRect","strokeRect","beginPath","closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","arcTo","rect","arc","fill","stroke","clip","isPointInPath","font","textAlign","textBaseline","fillText","strokeText","measureText","drawImage","createImageData","getImageData","putImageData","addColorStop"]);function n(a,b){this.canvas=a;this.G=b;this.r();(function(c){window.setInterval(function(){c.h===
0&&c.f()},30)})(this)}n.prototype={save:function(){this.l.push({globalAlpha:this.globalAlpha,c:this.c,strokeStyle:this.strokeStyle,fillStyle:this.fillStyle,lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,b:this.b,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,font:this.font,textAlign:this.textAlign,textBaseline:this.textBaseline});this.d();this.e();this.k();this.i();this.j();this.T();this.a.push(d.save)},
restore:function(){if(this.l.length>0){var a=this.l.pop();this.globalAlpha=a.globalAlpha;this.c=a.c;this.strokeStyle=a.strokeStyle;this.fillStyle=a.fillStyle;this.lineWidth=a.lineWidth;this.lineCap=a.lineCap;this.lineJoin=a.lineJoin;this.b=a.b;this.shadowOffsetX=a.shadowOffsetX;this.shadowOffsetY=a.shadowOffsetY;this.shadowBlur=a.shadowBlur;this.shadowColor=a.shadowColor;this.font=a.font;this.textAlign=a.textAlign;this.textBaseline=a.textBaseline}this.a.push(d.restore)},scale:function(a,b){this.a.push(d.scale,
a,b)},rotate:function(a){this.a.push(d.rotate,a)},translate:function(a,b){this.a.push(d.translate,a,b)},transform:function(a,b,c,e,g,f){this.a.push(d.transform,a,b,c,e,g,f)},setTransform:function(a,b,c,e,g,f){this.a.push(d.setTransform,a,b,c,e,g,f)},d:function(){var a=this.a;if(this.p!=this.globalAlpha){this.p=this.globalAlpha;a.push(d.globalAlpha,this.globalAlpha)}if(this.q!=this.c){this.q=this.c;a.push(d.c,this.c)}},k:function(){if(this.F!=this.strokeStyle){var a=this.F=this.strokeStyle;this.a.push(d.strokeStyle,
typeof a=="object"?a.id:a)}},i:function(){if(this.n!=this.fillStyle){var a=this.n=this.fillStyle;this.a.push(d.fillStyle,typeof a=="object"?a.id:a)}},createLinearGradient:function(a,b,c,e){this.a.push(d.createLinearGradient,a,b,c,e);return new k(this)},createRadialGradient:function(a,b,c,e,g,f){this.a.push(d.createRadialGradient,a,b,c,e,g,f);return new k(this)},createPattern:function(a,b){if(a.tagName.toUpperCase()=="IMG"){this.a.push(d.createPattern,a.src,b);this.f();this.J();return new u(this)}},
j:function(){var a=this.a;if(this.u!=this.lineWidth&&isFinite(this.lineWidth)){this.u=this.lineWidth;a.push(d.lineWidth,this.lineWidth)}if(this.s!=this.lineCap){this.s=this.lineCap;a.push(d.lineCap,this.lineCap)}if(this.t!=this.lineJoin){this.t=this.lineJoin;a.push(d.lineJoin,this.lineJoin)}if(this.w!=this.b&&isFinite(this.b)){this.w=this.b;a.push(d.b,this.b)}},e:function(){var a=this.a;if(this.C!=this.shadowOffsetX){this.C=this.shadowOffsetX;a.push(d.shadowOffsetX,this.shadowOffsetX)}if(this.D!=
this.shadowOffsetY){this.D=this.shadowOffsetY;a.push(d.shadowOffsetY,this.shadowOffsetY)}if(this.A!=this.shadowBlur){this.A=this.shadowBlur;a.push(d.shadowBlur,this.shadowBlur)}if(this.B!=this.shadowColor){this.B=this.shadowColor;a.push(d.shadowColor,this.shadowColor)}},clearRect:function(a,b,c,e){this.a.push(d.clearRect,a,b,c,e)},fillRect:function(a,b,c,e){this.d();this.e();this.i();this.a.push(d.fillRect,a,b,c,e)},strokeRect:function(a,b,c,e){this.d();this.e();this.k();this.j();this.a.push(d.strokeRect,
a,b,c,e)},beginPath:function(){this.a.push(d.beginPath)},closePath:function(){this.a.push(d.closePath)},moveTo:function(a,b){this.a.push(d.moveTo,a,b)},lineTo:function(a,b){this.a.push(d.lineTo,a,b)},quadraticCurveTo:function(a,b,c,e){this.a.push(d.quadraticCurveTo,a,b,c,e)},bezierCurveTo:function(a,b,c,e,g,f){this.a.push(d.bezierCurveTo,a,b,c,e,g,f)},arcTo:function(a,b,c,e,g){this.a.push(d.arcTo,a,b,c,e,g)},rect:function(a,b,c,e){this.a.push(d.rect,a,b,c,e)},arc:function(a,b,c,e,g,f){f=f?1:0;this.a.push(d.arc,
a,b,c,e,g,f)},fill:function(){this.d();this.e();this.i();this.a.push(d.fill)},stroke:function(){this.d();this.e();this.k();this.j();this.a.push(d.stroke)},clip:function(){this.a.push(d.clip)},T:function(){var a=this.a;if(this.o!=this.font){this.o=this.font;a.push(d.font,this.font)}if(this.H!=this.textAlign){this.H=this.textAlign;a.push(d.textAlign,this.textAlign)}if(this.I!=this.textBaseline){this.I=this.textBaseline;a.push(d.textBaseline,this.textBaseline)}},drawImage:function(){var a=arguments,
b=a.length;if(a[0].tagName.toUpperCase()=="IMG"){this.d();this.e();if(b==3)this.a.push(d.drawImage,b,a[0].src,a[1],a[2]);else if(b==5)this.a.push(d.drawImage,b,a[0].src,a[1],a[2],a[3],a[4]);else if(b==9)this.a.push(d.drawImage,b,a[0].src,a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]);else return;this.f();this.J()}},r:function(){this.globalAlpha=this.p=1;this.c=this.q="source-over";this.fillStyle=this.n=this.strokeStyle=this.F="#000000";this.lineWidth=this.u=1;this.lineCap=this.s="butt";this.lineJoin=this.t=
"miter";this.b=this.w=10;this.shadowBlur=this.A=this.shadowOffsetY=this.D=this.shadowOffsetX=this.C=0;this.shadowColor=this.B="rgba(0,0,0,0)";this.font=this.o="10px sans-serif";this.textAlign=this.H="start";this.textBaseline=this.I="alphabetic";this.a=[];this.l=[];this.h=0},Q:function(){var a=this.a;this.a=[];return a},f:function(){var a=this.Q();if(a.length>0)return eval(this.G.CallFunction('<invoke name="postCommands" returntype="javascript"><arguments><string>'+a.join("&#0;")+"</string></arguments></invoke>"))},
z:function(a,b){this.G.resize(a,b);this.r()},J:function(){++this.h;var a=this;setTimeout(function(){--a.h},100)}};function k(a){this.O=a;this.id=l(a)}k.prototype={addColorStop:function(a,b){this.O.a.push(d.addColorStop,this.id,a,b)}};function u(a){this.id=l(a)}var h={v:[],R:function(){if(document.readyState=="complete"){document.detachEvent("onreadystatechange",arguments.callee);for(var a=null;a=h.v.shift();)a();h.K=function(b){b()}}},K:function(a){h.v.push(a)},g:null,U:function(a,b){if(!h.g){h.g=
document.createStyleSheet();h.g.cssText=""}h.g.cssText+=a+" { "+b+"}"}};document.attachEvent("onreadystatechange",h.R);var i={V:function(a,b,c,e,g,f,o){if(f)for(var p in f)b+=encodeURIComponent(p)+"="+encodeURIComponent(f[p])+"&amp;";return'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+g+'" width="'+c+'" height="'+e+'"'+(a?' id="'+a+'"':"")+(o?' style="'+o+'"':"")+'>  <param name="allowScriptAccess" value="always">  <param name="movie" value="'+
b+'">  <param name="quality" value="high">  <param name="wmode" value="transparent"></object>'},W:function(a,b,c){return eval(a.CallFunction('<invoke name="'+b+'" returntype="javascript">'+i.M(c,0)+"</invoke>"))},N:function(a){for(var b="<array>",c=0;c<a.length;c++)b+='<property id="'+c+'">'+i.m(a[c])+"</property>";return b+"</array>"},M:function(a,b){var c="<arguments>";for(b=b;b<a.length;b++)c+=i.m(a[b]);return c+"</arguments>"},S:function(a){var b="<object>";for(var c in a)b+='<property id="'+
c+'">'+i.m(a[c])+"</property>";return b+"</object>"},P:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},m:function(a){var b=typeof a;return b=="string"?"<string>"+i.P(a)+"</string>":b=="undefined"?"<undefined/>":b=="number"?"<number>"+a+"</number>":a==null?"<null/>":b=="boolean"?a?"<true/>":"<false/>":a instanceof Date?"<date>"+a.getTime()+"</date>":a instanceof Array?i.N(a):b=="object"?i.S(a):"<null/>"}},j={L:function(a){var b=
300,c=150;if(a.attributes.width!=undefined)b=Math.max(Number(a.getAttribute("width"))||0,0);if(a.attributes.height!=undefined)c=Math.max(Number(a.getAttribute("height"))||0,0);a.style.width=b+"px";a.style.height=c+"px";a.innerHTML=i.V("flashcanvas-"+a.uniqueID,m,"100%","100%","9,0,0,0");var e=new n(a,a.firstChild);a.getContext=function(g){return g=="2d"?e:null};a.toDataURL=function(){e.a.push(d.toDataURL);return e.f()};a.attachEvent("onpropertychange",s);e.z(b,c)}};document.createElement("canvas");
h.U("canvas","display: inline-block; overflow: hidden; width: 300px; height: 150px;");h.K(function(){for(var a=document.getElementsByTagName("canvas"),b=0,c=a.length;b<c;++b)a[b].getContext||j.L(a[b])});window.attachEvent("onbeforeunload",t);var q=new ActiveXObject("Microsoft.XMLHTTP");q.open("GET",m,false);q.send(null);window.FlashCanvas=j;j.initElement=j.L})();
